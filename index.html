<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ATC Radar Display</title>

<style>
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family: monospace;
  color:#9f9;
}

#topbar{
  height:28px;
  background:#8fa6b8;
  color:#000;
  display:flex;
  align-items:center;
  padding:0 8px;
  font-size:13px;
}

#topbar .right{
  margin-left:auto;
}

canvas{
  display:block;
}
</style>
</head>

<body>

<div id="topbar">
  <b>18 : 06 : 31</b>
  <span style="margin-left:10px;">Settings</span>
  <span style="margin-left:10px;">AirSitu</span>
  <span style="margin-left:10px;">Info</span>
  <div class="right">ATC SURVEILLANCE</div>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight - 28;
}
addEventListener("resize", resize);
resize();

/* ================= AIRCRAFT ================= */

const TYPES = [
  {name:"Passenger", color:"#00ff66", shape:"diamond"},
  {name:"Cargo", color:"#00ffff", shape:"rect"},
  {name:"Friendly", color:"#ffd700", shape:"triangle"},
  {name:"Foreign", color:"#ffffff", shape:"square"}
];

function wp(x,y){ return {x,y}; }

function spawn(){
  const t = TYPES[Math.floor(Math.random()*TYPES.length)];
  return {
    type:t,
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    route:[
      wp(Math.random()*canvas.width,Math.random()*canvas.height),
      wp(Math.random()*canvas.width,Math.random()*canvas.height),
      wp(Math.random()*canvas.width,Math.random()*canvas.height),
      wp(Math.random()*canvas.width,Math.random()*canvas.height)
    ],
    wpIndex:0,
    speed:5,
    callsign: randomCallsign(),
    alt: Math.floor(240+Math.random()*120),
    cfl: Math.floor(300+Math.random()*80)
  };
}

function randomCallsign(){
  const a=["AFR","BAW","SWR","DLH","EZY","AAL","ANA"];
  return a[Math.floor(Math.random()*a.length)] + Math.floor(100+Math.random()*900);
}

const aircraft = [];
for(let i=0;i<18;i++) aircraft.push(spawn());

/* ================= DRAW ================= */

function drawSymbol(a){
  ctx.strokeStyle = a.type.color;
  ctx.lineWidth = 1;
  ctx.beginPath();

  switch(a.type.shape){
    case "diamond":
      ctx.moveTo(a.x,a.y-6);
      ctx.lineTo(a.x+6,a.y);
      ctx.lineTo(a.x,a.y+6);
      ctx.lineTo(a.x-6,a.y);
      ctx.closePath();
      break;
    case "square":
      ctx.rect(a.x-5,a.y-5,10,10);
      break;
    case "triangle":
      ctx.moveTo(a.x,a.y-6);
      ctx.lineTo(a.x+6,a.y+6);
      ctx.lineTo(a.x-6,a.y+6);
      ctx.closePath();
      break;
    case "rect":
      ctx.rect(a.x-7,a.y-4,14,8);
      break;
  }
  ctx.stroke();
}

function drawLabel(a){
  ctx.fillStyle = a.type.color;
  ctx.font = "11px monospace";
  ctx.fillText(a.callsign, a.x+8, a.y-8);
  ctx.fillText(`S F${a.alt} â†‘ CFL`, a.x+8, a.y+4);
}

/* ================= UPDATE ================= */

let last = performance.now();

function update(now){
  if(now-last < 900) return requestAnimationFrame(update);
  last = now;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  aircraft.forEach(a=>{
    const wp = a.route[a.wpIndex];
    const dx = wp.x - a.x;
    const dy = wp.y - a.y;
    const d = Math.hypot(dx,dy);

    if(d < 10){
      a.wpIndex = (a.wpIndex+1) % a.route.length;
    } else {
      a.x += dx/d * a.speed;
      a.y += dy/d * a.speed;
    }

    /* heading vector */
    ctx.strokeStyle = a.type.color;
    ctx.beginPath();
    ctx.moveTo(a.x,a.y);
    ctx.lineTo(a.x + dx/d*25, a.y + dy/d*25);
    ctx.stroke();

    drawSymbol(a);
    drawLabel(a);
  });

  requestAnimationFrame(update);
}

requestAnimationFrame(update);
</script>

</body>
</html>
